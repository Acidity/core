## encoding: utf-8

<%inherit file="brave.core.template.master"/>

<%block name="title">Dashboard</%block>

<%block name="header">
    ${parent.header()}
    
    <style>
        .user-profile .header span.area { color: #7d848c; font-style: italic; font-size: 14px; }
        .user-profile .header .avatar { width: 96px; height: 96px; float: left; margin-right: 25px; border: 2px solid #e9ecee; position: relative; top: 3px; border-radius: 12px; }
        .user-profile .header .name { font-weight: 600; margin: 0 0 10px; line-height: 26px; float: none; padding-top: 12px; }
        .user-profile .header .area span { margin: 0 5px; }
        #pad-wrapper.user-profile h4 { margin: 0 0 10px; font-weight: 600; font-size: 14px; font-style: normal; text-indent: 0; color: black; }
        .user-profile .profile .bio p { 
    </style>
</%block>

<%block name="post">
    ${parent.post()}

    <script type="text/javascript" charset="utf-8">
        $(function(){
            $('time').timeago();
        });
    </script>
</%block>

<div class="container-fluid">
    <div id="pad-wrapper" class="user-profile">
    % if user.primary:
        <div class="header">
            <img src="//image.eveonline.com/Character/${user.primary.identifier}_128.jpg" class="avatar">
            
            <h3 class="name">${user.primary.name | h}</h3>
            <span class="area">
            ${", ".join(user.primary.titles) | h}
            </span>
            <div class="area">
                <a target="_blank" href="https://gate.eveonline.com/Corporation/${user.primary.corporation.name | u}">${user.primary.corporation.name | h}</a>
                % if user.primary.alliance:
                <span>â€º</span> <a target="_blank" href="https://gate.eveonline.com/Alliance/${user.primary.alliance.name | u}">${user.primary.alliance.name | h}</a>
                % endif
            </div>
        </div>
        
        <div class="row-fluid profile">
            <div class="span7 bio" style="box-shadow: 4px 0px 3px -1px rgba(226,226,226,0.1); border-right: 1px solid #edeef1">
                <div class="profile-box" style="padding-right: 25px;">
                    <div id="pad-wrapper">
        <div class="row-fluid header">
    % else:
        <div class="header">
            <h3 class="name">${user | h}</h3>
            <div class="area">
            </div>
        </div>
        
        <div class="row-fluid profile">
            <div class="span7 bio" style="box-shadow: 4px 0px 3px -1px rgba(226,226,226,0.1); border-right: 1px solid #edeef1">
                <div class="profile-box" style="padding-right: 25px;">
                    <div id="pad-wrapper">
        <div class="row-fluid header">
    % endif
    
            <h3>EVE Online Characters</h3>
        </div>
        
        <div class="row-fluid table">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th class="span2 sortable name">Name</th>
                        <th class="span3 sortable corporation"><span class="line"></span>Corporation</th>
                        <th class="span3 sortable alliance"><span class="line"></span>Alliance</th>
                        <th class="span3 sortable username"><span class="line"></span>User</th>
                    </tr>
                </thead>
                <tbody>
                    % for record in user.characters:
                    <tr data-id="${record.id}">
                        <td class="name">
                            <span class="ellipsis">
                            <img src="//image.eveonline.com/Character/${record.identifier}_32.jpg" style="vertical-align: -55%; margin-right: 5px; border-radius: 6px; width: 32px; height: 32px;">
                            <a href="/character/${record.identifier}">
                            <strong>${record.name | h}</strong>
                            </a>
                            </span>
                        </td>
                        <td class="corporation">
                            <span class="ellipsis">
                            <img src="//image.eveonline.com/Corporation/${record.corporation.identifier}_32.png" style="vertical-align: -55%; margin-right: 5px; width: 32px; height: 32px;">
                            ${record.corporation.name | h}
                            </span>
                        </td>
                        <td class="alliance">
                            % if record.alliance:
                            <span class="ellipsis">
                            <img src="//image.eveonline.com/Alliance/${record.alliance.identifier}_32.png" style="vertical-align: -55%; margin-right: 5px; width: 32px; height: 32px;">
                            ${record.alliance.name | h}
                            </span>
                            % else:
                            <em>None</em>
                            % endif
                        </td>
                        <td class="username">
                            <span class="ellipsis">
                            ${record.owner | h}
                            </span>
                        </td>
                    </tr>
                    % endfor
                </tbody>
            </table>
        </div>
    </div>
    
    <div id="pad-wrapper">
        <div class="row-fluid header">
            <h3>${_("EVE Online API Keys")}</h3>
        </div>
        <div class="row-fluid table">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th class="span2 sortable key-id">${_("Key ID")}</th>
                        <th class="span2 sortable security-violation">${_("Security Violation")}</th>
                        <th class="span2 sortable key-code"><span class="line"></span>${_("Code")}</th>
                        <th class="span2 sortable characters hidden-tablet hidden-phone"><span class="line"></span>${_("Characters")}</th>
                        <th class="span2 sortable key-date hidden-phone"><span class="line"></span>${_("Added")}</th>
                        <th class="span2 sortable username"><span class="line"></span>${_("User")}</th>
                    </tr>
                </thead>
                <tbody>
                    % for record in user.credentials:
                    <tr data-id="${record.id}">
                        <td class="key-id"><i class="fa fa-fw fa-${'check' if record.verified else 'times'}"></i> <a href="/key/${record.id}">${record.key | h}</a></td>
                        % if record.violation == "Character":
                        <td class="security-violation" title="One or more characters associated with this key was found on another account. Join the 'Brave IT Team' channel in game for assistance."><font color="red">Character Security Violation.</font></td>
                        % else:
                        <td class="security-violation" title="All clear!"><font color="green">The BIA is always watching...</font></td>
                        % endif
                        <td class="key-code"><span class="ellipsis">Redacted.</span></td>
                        <td class="characters hidden-tablet hidden-phone">
                            % for char in record.characters:
                            <img src="//image.eveonline.com/Character/${char.identifier}_32.jpg" style="vertical-align: middle; margin-right: 5px; border-radius: 3px; width: 24px; height: 24px;" title="${char.name | u}">
                            % endfor
                        </td>
                        <td class="key-date hidden-phone"><time datetime="${record.id.generation_time.isoformat().replace('+00:00', 'Z')}">${record.id.generation_time.isoformat(' ').replace('+00:00', '')}</time></td>
                        <td class="username">${record.owner | h}</td>
                    </tr>
                    % endfor
                </tbody>
            </table>
        </div>
    </div>
                    
                    <h4>Authentication Attempts</h4>
                    
                    <style>.table td {  } .table thead th { padding-bottom: 5px; }</style>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="span5">
                                    Date
                                </th>
                                <th class="span6">
                                    <span class="line"></span>
                                    From
                                </th>
                                <th class="span1">
                                    <span class="line"></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            % for attempt in user.attempts.order_by('-id').limit(10):
                            <tr>
                                <td><time datetime="${attempt.id.generation_time.isoformat().replace('+00:00', 'Z')}">${attempt.id.generation_time.isoformat(' ').replace('+00:00', '')}</time></td>
                                <td>${attempt.location | h}</td>
                                % if attempt.success:
                                <td><i class="fa fa-check-circle-o fa-lg text-success"></i></td>
                                % else:
                                <td><i class="fa fa-times-circle-o fa-lg text-error"></i></td>
                                % endif
                            </tr>
                            % endfor
                        </tbody>
##                        <tfoot>
##                            <tr>
##                                <th colspan="5" style="text-align: center;"><a href="">View Full Authentication History</a></th>
##                            </tr>
##                        </tfoot>
                    </table>
        
                </div>
            </div>
        
            <!-- side address column -->
            <div class="span5 pull-right">
                <h4>Authorized Applications</h4>
                <ul>
                    % for grant in user.grants:
                    <li><a target="_blank" href="${grant.application.site | u}" title="${grant.application.description | u}">${grant.application.name | h}</a></li>
                    % endfor
                </ul>
                
                <hr>
                % if user.primary:
                <h4>Group Membership</h4>
                <ul>
                    % for id, group in user.primary.tags.iteritems():
                    <li>${group.title | h}</li>
                    % endfor
                </ul>
                % endif
            </div>
        </div>
    </div>
</div>
